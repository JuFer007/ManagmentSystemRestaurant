<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <title>Mantenimiento del Sistema - The Grill House</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .header {
            background: linear-gradient(135deg, #d66a24 0%, #e07635 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .action-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        .action-card:hover {
            transform: translateY(-5px);
        }
        .icon-box {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #d66a24 0%, #e07635 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        .icon-box i {
            font-size: 30px;
            color: white;
        }
        .btn-action {
            width: 100%;
            padding: 12px;
            font-weight: 600;
            border-radius: 10px;
        }
    </style>
</head>
<body>
<div class="container mt-5 mb-5">
    <!-- Header -->
    <div class="header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="ri-tools-line"></i> Mantenimiento del Sistema</h1>
                <p class="mb-0">Herramientas de administración y mantenimiento</p>
            </div>
            <div>
                <a href="/index" class="btn btn-light">
                    <i class="ri-arrow-left-line"></i> Volver al Sistema
                </a>
            </div>
        </div>
    </div>

    <!-- Sección de Respaldo -->
    <div class="row">
        <div class="col-md-6">
            <div class="action-card">
                <div class="icon-box mx-auto" style="width: 80px; height: 80px;">
                    <i class="ri-database-2-line"></i>
                </div>
                <h4 class="text-center mb-3">Respaldo de Base de Datos</h4>
                <p class="text-center text-muted">
                    Crea una copia de seguridad completa de la base de datos MySQL.
                    El archivo se guardará en la carpeta <code>backups/</code>
                </p>
                <button class="btn btn-primary btn-action" onclick="ejecutarBackup()">
                    <i class="ri-save-line me-2"></i>Crear Respaldo Ahora
                </button>
                <div id="backupResult" class="mt-3"></div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="action-card">
                <div class="icon-box mx-auto" style="width: 80px; height: 80px;">
                    <i class="ri-delete-bin-line"></i>
                </div>
                <h4 class="text-center mb-3">Limpieza de Archivos</h4>
                <p class="text-center text-muted">
                    Elimina archivos temporales antiguos para liberar espacio en disco.
                </p>
                <button class="btn btn-warning btn-action mb-2" onclick="limpiarTemporales()">
                    <i class="ri-file-shred-line me-2"></i>Limpiar Temporales
                </button>
                <button class="btn btn-info btn-action" onclick="limpiarLogs()">
                    <i class="ri-file-list-line me-2"></i>Limpiar Logs Antiguos
                </button>
                <div id="cleanupResult" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Información del Sistema -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="action-card">
                <h4 class="mb-4"><i class="ri-information-line"></i> Información del Sistema</h4>
                <button class="btn btn-secondary" onclick="obtenerInfoSistema()">
                    <i class="ri-refresh-line me-2"></i>Actualizar Información
                </button>
                <div id="systemInfo" class="mt-4">
                    <p class="text-muted">Haz clic en "Actualizar Información" para ver los detalles</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Ejecutar Backup
    async function ejecutarBackup() {
        const btn = event.target;
        const result = document.getElementById('backupResult');

        btn.disabled = true;
        btn.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>Creando respaldo...';
        result.innerHTML = '<div class="alert alert-info">Creando respaldo de la base de datos...</div>';

        try {
            const response = await fetch('/system/maintenance/backup', {
                method: 'POST'
            });

            if (response.ok) {
                const data = await response.text();
                result.innerHTML = `
                    <div class="alert alert-success">
                        <i class="ri-check-line me-2"></i>
                        <strong>¡Respaldo creado exitosamente!</strong><br>
                        <small>Archivo: Ubicado en la carpte de backups</small>
                    </div>`;
            } else {
                throw new Error('Error al crear respaldo');
            }
        } catch (error) {
            result.innerHTML = `
                <div class="alert alert-danger">
                    <i class="ri-error-warning-line me-2"></i>
                    Error: ${error.message}
                </div>`;
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="ri-save-line me-2"></i>Crear Respaldo Ahora';
        }
    }

    // Limpiar Temporales
    async function limpiarTemporales() {
        const result = document.getElementById('cleanupResult');
        result.innerHTML = '<div class="alert alert-info">Limpiando archivos temporales...</div>';

        try {
            const response = await fetch('/system/maintenance/cleanup/temp', {
                method: 'POST'
            });
            const data = await response.json();

            if (data.status === 'success') {
                result.innerHTML = `
                    <div class="alert alert-success">
                        <i class="ri-check-line me-2"></i>${data.message}
                    </div>`;
            } else {
                throw new Error(data.message);
            }
        } catch (error) {
            result.innerHTML = `
                <div class="alert alert-danger">
                    <i class="ri-error-warning-line me-2"></i>Error: ${error.message}
                </div>`;
        }
    }

    // Limpiar Logs
    async function limpiarLogs() {
        const result = document.getElementById('cleanupResult');
        result.innerHTML = '<div class="alert alert-info">Limpiando logs antiguos...</div>';

        try {
            const response = await fetch('/system/maintenance/cleanup/logs', {
                method: 'POST'
            });
            const data = await response.json();

            if (data.status === 'success') {
                result.innerHTML = `
                    <div class="alert alert-success">
                        <i class="ri-check-line me-2"></i>${data.message}
                    </div>`;
            } else {
                throw new Error(data.message);
            }
        } catch (error) {
            result.innerHTML = `
                <div class="alert alert-danger">
                    <i class="ri-error-warning-line me-2"></i>Error: ${error.message}
                </div>`;
        }
    }

    // Obtener Info del Sistema
    async function obtenerInfoSistema() {
        const infoDiv = document.getElementById('systemInfo');
        infoDiv.innerHTML = '<div class="spinner-border text-primary"></div>';

        try {
            const response = await fetch('/system/maintenance/system-info');
            const data = await response.json();

            infoDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>Recursos del Sistema</h6>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Memoria Total:</span>
                                <strong>${data.totalMemory}</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Memoria Libre:</span>
                                <strong>${data.freeMemory}</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Memoria Máxima:</span>
                                <strong>${data.maxMemory}</strong>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Información del Sistema</h6>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Procesadores:</span>
                                <strong>${data.availableProcessors}</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Versión Java:</span>
                                <strong>${data.javaVersion}</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Sistema Operativo:</span>
                                <strong>${data.osName} ${data.osVersion}</strong>
                            </li>
                        </ul>
                    </div>
                </div>`;
        } catch (error) {
            infoDiv.innerHTML = `
                <div class="alert alert-danger">
                    Error al obtener información: ${error.message}
                </div>`;
        }
    }
</script>
</body>
</html>