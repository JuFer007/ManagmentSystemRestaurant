<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Iconos -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Estilos -->
    <link href="/css/styleSystem.css" rel="stylesheet">
    <title>The Grill House - Sistema de Gestión</title>
</head>
<body>
<aside class="sidebar">
    <div class="logo-section">
        <div class="logo-icon">
            <img src="imagenes/logoRestaurante.png" alt="Logo The Grill House">
        </div>
        <div class="brand-title">The Grill House</div>
        <div class="brand-sub">Restaurant System</div>
    </div>
    <nav>
        <div class="nav-item active" onclick="loadPage('dashboard', this)">
            <i class="ri-bar-chart-2-line"></i> <span>Dashboard</span>
        </div>
        <div class="nav-group">
            <div class="nav-group-title" onclick="toggleSubmenu(this)">
                <span><i class="fa-solid fa-clipboard-list"></i> Gestión</span>
                <span class="arrow">▶</span>
            </div>
            <div class="submenu">
                <div class="nav-item" onclick="loadPage('empleados', this)">
                    <i class="ri-user-2-line"></i> <span>Empleados</span>
                </div>
                <div class="nav-item" onclick="loadPage('clientes', this)">
                    <i class="ri-user-heart-line"></i> <span>Clientes</span>
                </div>
            </div>
        </div>
        <div class="nav-group">
            <div class="nav-group-title" onclick="toggleSubmenu(this)">
                <span><i class="fa-solid fa-receipt"></i> Pedidos</span>
                <span class="arrow">▶</span>
            </div>
            <div class="submenu">
                <div class="nav-item" onclick="loadPage('nuevo-pedido', this)">
                    <i class="ri-restaurant-2-line"></i> <span>Nuevo Pedido</span>
                </div>
                <div class="nav-item" onclick="loadPage('pedidos', this)">
                    <i class="ri-file-list-3-line"></i> <span>Ver Pedidos</span>
                </div>
            </div>
        </div>
        <div class="nav-group">
            <div class="nav-group-title" onclick="toggleSubmenu(this)">
                <span><i class="fa-solid fa-burger"></i> Menú</span>
                <span class="arrow">▶</span>
            </div>
            <div class="submenu">
                <div class="nav-item" onclick="loadPage('platos', this)">
                    <i class="ri-bowl-fill"></i> <span>Platos</span>
                </div>
            </div>
        </div>
        <div class="nav-group">
            <div class="nav-group-title" onclick="toggleSubmenu(this)">
                <span><i class="fa-solid fa-coins"></i> Finanzas</span>
                <span class="arrow">▶</span>
            </div>
            <div class="submenu">
                <div class="nav-item" onclick="loadPage('pagos', this)">
                    <i class="ri-wallet-3-line"></i> <span>Pagos</span>
                </div>
            </div>
        </div>
    </nav>
    <a class="logout-btn" th:href="@{/login}" onclick="logout(); return false;"><i class="ri-logout-box-r-line"></i><span>Cerrar Sesion</span></a>
</aside>

<main class="main-content">
    <header class="header">
        <div class="header-title">
            <h1 id="pageTitle">Dashboard Principal</h1>
            <p id="pageDesc">Gestión integral del restaurante</p>
        </div>
        <div class="user-badge">
            <div class="user-avatar">A</div>
            <span style="font-weight: 600; font-size: 14px;">Admin</span>
        </div>
    </header>

    <div class="content" id="content">

        <div id="clientesDiv" class="page-section" style="display:none;">
            <!-- Tabla de clientes -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Lista de Clientes</h3>
                </div>
                <div class="table-container">
                    <table class="table" id="clientesTable">
                        <thead>
                        <tr>
                            <th><strong>DNI</strong></th>
                            <th><strong></strong>Nombre</th>
                            <th><strong></strong>Apellidos</th>
                            <th><strong></strong>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Thymeleaf loop -->
                        <tr th:each="cliente : ${clientes}">
                            <td th:text="${cliente.dniCliente}">DNI</td>
                            <td th:text="${cliente.nombreCliente}">Nombre</td>
                            <td th:text="${cliente.apellidosCliente}">Apellidos</td>
                            <td>
                                <a th:href="@{'/system/editar/' + ${cliente.dniCliente}}" class="btn btn-primary"><i class="fa-solid fa-pen-to-square"></i> Modificar</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Formulario agregar/modificar -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Agregar o Modificar Cliente</h3>
                </div>
                <div class="card-body">
                    <form th:action="@{/system/guardar}" method="post">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nombre</label>
                                <input type="text" class="form-input" name="nombreCliente"
                                       placeholder="Nombre del cliente"
                                       th:value="${cliente != null} ? ${cliente.nombreCliente} : ''">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Apellidos</label>
                                <input type="text" class="form-input" name="apellidosCliente"
                                       placeholder="Apellidos"
                                       th:value="${cliente != null} ? ${cliente.apellidosCliente} : ''">
                            </div>
                            <div class="form-group">
                                <label class="form-label">DNI</label>
                                <input type="text" class="form-input" name="dniCliente"
                                       placeholder="12345678"
                                       th:value="${cliente != null} ? ${cliente.dniCliente} : ''">
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button type="submit" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div id="empleadosDiv" class="page-section" style="display:none;">
            <h2>Empleados</h2>
            <p>Módulo en construcción...</p>
        </div>

        <div id="pedidosDiv" class="page-section" style="display:none;">
            <h2>Gestión de Platos</h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-top: 20px;">
                <div th:each="plato : ${platos}"
                     style="background: #fff; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.15); overflow: hidden; transition: transform 0.3s ease;">

                    <img th:src="@{${plato.imagenUrl}}" alt="Imagen del plato"
                         style="width: 100%; height: 160px; object-fit: cover;">

                    <div style="padding: 15px;">
                        <h3 th:text="${plato.nombrePlato}" style="margin-bottom: 5px; font-size: 1.2em; color: #333;"></h3>
                        <p style="margin: 0; font-weight: bold; color: #2a9d8f;">
                            S/. <span th:text="${#numbers.formatDecimal(plato.precioPlato, 1, 'POINT', 2, 'NONE')}"></span>
                        </p>
                        <p style="margin: 5px 0; color: #555;">
                            Estado: <span th:text="${plato.disponibilidad}"
                                          th:style="${plato.disponibilidad == 'Disponible'} ? 'color:green;' : 'color:red;'"></span>
                        </p>
                    </div>
                </div>
            </div>

            <div style="margin-top: 40px;">
                <h3>Agregar Nuevo Plato</h3>
                <form th:action="@{/system/platos/agregar}" method="post" enctype="multipart/form-data"
                      style="display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end;">

                    <div style="flex: 1;">
                        <label>Nombre del Plato</label>
                        <input type="text" name="nombrePlato" class="form-input" required>
                    </div>
                    <div style="flex: 1;">
                        <label>Precio</label>
                        <input type="number" step="0.01" name="precioPlato" class="form-input" required>
                    </div>
                    <div style="flex: 1;">
                        <label>Disponibilidad</label>
                        <select name="disponibilidad" class="form-input">
                            <option value="Disponible">Disponible</option>
                            <option value="No Disponible">No Disponible</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label>Imagen del Plato</label>
                        <input type="file" name="imagen" accept="image/*" class="form-input" required>
                    </div>
                    <div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fa-solid fa-floppy-disk"></i> Guardar Plato
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div id="platosDiv" class="page-section" style="display:none;">
            <h2>Platos</h2>
            <p>Módulo en construcción...</p>
        </div>

        <div id="pagosDiv" class="page-section" style="display:none;">
            <h2>Pagos</h2>
            <p>Módulo en construcción...</p>
        </div>
    </div>


</main>

<script>
    // ------------------------------------
    // Toggle de submenus
    // ------------------------------------
    function toggleSubmenu(element) {
        const submenu = element.nextElementSibling;
        const isOpen = element.classList.contains('open');
        document.querySelectorAll('.nav-group-title').forEach(title => {
            title.classList.remove('open');
            title.nextElementSibling.classList.remove('open');
        });
        if (!isOpen) {
            element.classList.add('open');
            submenu.classList.add('open');
            // Guardar submenu abierto
            localStorage.setItem('openSubmenu', element.textContent.trim());
        } else {
            localStorage.removeItem('openSubmenu');
        }
    }

    // ------------------------------------
    // Cerrar sesión
    // ------------------------------------
    function logout() {
        if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
            window.location.href = '/login';
        }
    }

    // ------------------------------------
    // Mostrar/ocultar secciones según nav-item
    // ------------------------------------
    const sections = {
        'dashboard': 'dashboardDiv',
        'clientes': 'clientesDiv',
        'empleados': 'empleadosDiv',
        'pedidos': 'pedidosDiv',
        'platos': 'platosDiv',
        'pagos': 'pagosDiv'
    };

    function showSection(sectionKey) {
        for (const key in sections) {
            const div = document.getElementById(sections[key]);
            if (div) {
                div.style.display = (key === sectionKey) ? 'block' : 'none';
            }
        }

        // Actualizar título y descripción
        const titles = {
            'dashboard': ['Dashboard Principal', 'Gestión integral del restaurante'],
            'clientes': ['Gestión de Clientes', 'Administra la base de clientes'],
            'empleados': ['Gestión de Empleados', 'Administra el personal del restaurante'],
            'pedidos': ['Gestión de Pedidos', 'Visualiza y administra los pedidos'],
            'platos': ['Gestión de Platos', 'Administra los platos del restaurante'],
            'pagos': ['Gestión de Pagos', 'Administra los pagos y comprobantes']
        };

        if (titles[sectionKey]) {
            document.getElementById('pageTitle').textContent = titles[sectionKey][0];
            document.getElementById('pageDesc').textContent = titles[sectionKey][1];
        }

        // Guardar la sección activa en localStorage
        localStorage.setItem('activeSection', sectionKey);

        // Abrir submenu correspondiente según sección
        openSubmenuBySection(sectionKey);
    }

    // ------------------------------------
    // Abrir submenu según sección guardada
    // ------------------------------------
    function openSubmenuBySection(sectionKey) {
        const mapping = {
            'empleados': 'Gestión',
            'clientes': 'Gestión',
            'nuevo-pedido': 'Pedidos',
            'pedidos': 'Pedidos',
            'platos': 'Pedidos',
            'pagos': 'Finanzas'
        };

        const groupName = mapping[sectionKey];
        document.querySelectorAll('.nav-group-title').forEach(title => {
            if (title.textContent.trim().includes(groupName)) {
                title.classList.add('open');
                title.nextElementSibling.classList.add('open');
                localStorage.setItem('openSubmenu', groupName);
            } else {
                title.classList.remove('open');
                title.nextElementSibling.classList.remove('open');
            }
        });
    }

    // ------------------------------------
    // Asignar event listeners a nav-items
    // ------------------------------------
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
            const page = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            showSection(page);

            // Actualizar clase activa
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // ------------------------------------
    // Inicializar mostrando la sección guardada y submenu abierto
    // ------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
        const activeSection = localStorage.getItem('activeSection') || 'dashboard';
        showSection(activeSection);

        // Marcar nav-item activo
        document.querySelectorAll('.nav-item').forEach(i => {
            i.classList.remove('active');
            const page = i.getAttribute('onclick').match(/'([^']+)'/)[1];
            if(page === activeSection) i.classList.add('active');
        });

        // Abrir submenu guardado
        const openSubmenu = localStorage.getItem('openSubmenu');
        if(openSubmenu) {
            document.querySelectorAll('.nav-group-title').forEach(title => {
                if(title.textContent.trim().includes(openSubmenu)) {
                    title.classList.add('open');
                    title.nextElementSibling.classList.add('open');
                }
            });
        }
    });
</script>



</body>
</html>
